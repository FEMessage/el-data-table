var ElDataTable=function(e,t,i){"use strict";function n(e){n.installed||(n.installed=!0,e.component("ElDataTable",s))}t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i,function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),i=".el-data-table .ms-tree-space { position: relative; top: 1px; display: inline-block; font-style: normal; font-weight: 400; line-height: 1; width: 18px; height: 14px; } .el-data-table .ms-tree-space::before { content: ''; } .el-data-table .tree-ctrl { position: relative; cursor: pointer; color: #2196f3; } @-moz-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @-webkit-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @-o-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)),e.appendChild(t)}}();var a=new RegExp("~","g"),o=new RegExp("q=.*,"),s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"el-data-table"},[e.searchForm.length>0||e.$slots.search?i("el-form-renderer",{ref:"searchForm",attrs:{inline:"",content:e.searchForm}},[e._t("search"),e._v(" "),i("el-form-item",[i("el-button",{attrs:{"native-type":"submit",type:"primary",size:"small"},on:{click:e.search}},[e._v("查询")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:e.resetSearch}},[e._v("重置")])],1)],2):e._e(),e._v(" "),e.hasNew||e.hasDelete||e.headerButtons.length>0?i("el-form",[i("el-form-item",[e.hasNew?i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onDefaultNew}},[e._v("新增")]):e._e(),e._v(" "),e._l(e.headerButtons,function(t,n){return"show"in t&&!t.show(e.selected)?e._e():i("el-button",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.customButtonsLoading,expression:"customButtonsLoading"}],key:n,attrs:{disabled:"disabled"in t&&t.disabled(e.selected),size:"small"},on:{click:function(i){e.onCustomButtonsClick(t.atClick,e.selected)}}},"el-button",t,!1),[e._v(e._s(t.text))])}),e._v(" "),e.hasSelect&&e.hasDelete?i("el-button",{attrs:{type:"danger",size:"small",disabled:e.single?!e.selected.length||e.selected.length>1:!e.selected.length},on:{click:function(t){e.onDefaultDelete(t)}}},[e._v("删除")]):e._e()],2)],1):e._e(),e._v(" "),i("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{data:e.data,"row-style":e.showRow},on:{"selection-change":e.handleSelectionChange}},"el-table",e.tableAttrs,!1),[e.isTree?[e.hasSelect?[i("el-table-column",e._b({key:"selection-key"},"el-table-column",e.columns[0],!1)),e._v(" "),i("el-table-column",e._b({key:"tree-ctrl",scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(t){return e.isTree?i("span",{key:t,staticClass:"ms-tree-space"}):e._e()}),e._v(" "),e.isTree&&e.iconShow(t.$index,t.row)?i("span",{staticClass:"tree-ctrl",on:{click:function(i){e.toggleExpanded(t.$index)}}},[t.row._expanded?i("i",{staticClass:"el-icon-minus"}):i("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(t.row[e.columns[1].prop])+" ")]}}])},"el-table-column",e.columns[1],!1)),e._v(" "),e._l(e.columns.filter(function(e,t){return 0!==t&&1!==t}),function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))})]:[i("el-table-column",e._b({key:"tree-ctrl",scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(t){return e.isTree?i("span",{key:t,staticClass:"ms-tree-space"}):e._e()}),e._v(" "),e.isTree&&e.iconShow(t.$index,t.row)?i("span",{staticClass:"tree-ctrl",on:{click:function(i){e.toggleExpanded(t.$index)}}},[t.row._expanded?i("i",{staticClass:"el-icon-minus"}):i("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(t.row[e.columns[0].prop])+" ")]}}])},"el-table-column",e.columns[0],!1)),e._v(" "),e._l(e.columns.filter(function(e,t){return 0!==t}),function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))})]]:e._l(e.columns,function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))}),e._v(" "),e.hasOperation?i("el-table-column",e._b({attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isTree&&e.hasNew?i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){e.onDefaultNew(t.row)}}},[e._v("新增")]):e._e(),e._v(" "),e.hasEdit?i("el-button",{attrs:{size:"small"},on:{click:function(i){e.onDefaultEdit(t.row)}}},[e._v(" 修改 ")]):e._e(),e._v(" "),e.hasView?i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(i){e.onDefaultView(t.row)}}},[e._v(" 查看 ")]):e._e(),e._v(" "),e._l(e.extraButtons,function(n,a){return"show"in n&&!n.show(t.row)?e._e():i("el-button",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.customButtonsLoading,expression:"customButtonsLoading"}],key:a,attrs:{size:"small"},on:{click:function(i){e.onCustomButtonsClick(n.atClick,t.row)}}},"el-button",n,!1),[e._v(" "+e._s(n.text)+" ")])}),e._v(" "),!e.hasSelect&&e.hasDelete&&e.canDelete(t.row)?i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){e.onDefaultDelete(t.row)}}},[e._v(" 删除 ")]):e._e()]}}])},"el-table-column",e.operationAttrs,!1)):e._e(),e._v(" "),e._t("default")],2),e._v(" "),e.hasPagination?i("el-pagination",{staticStyle:{"text-align":"right",padding:"10px 0"},attrs:{"current-page":e.page,"page-sizes":e.paginationSizes,"page-size":e.size,total:e.total,layout:e.paginationLayout},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e(),e._v(" "),e.hasDialog?i("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form-renderer",e._b({ref:"dialogForm",attrs:{content:e.form,disabled:e.isView}},"el-form-renderer",e.formAttrs,!1),[e._t("form")],2),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isView,expression:"!isView"}],attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("取 消")]),e._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.confirmLoading,expression:"confirmLoading"}],attrs:{type:"primary",size:"small"},on:{click:e.confirm}},[e._v("确 定")])],1)],1):e._e()],1)},staticRenderFns:[],name:"ElDataTable",props:{url:{type:String,default:""},id:{type:String,default:"id"},firstPage:{type:Number,default:1},dataPath:{type:String,default:"payload.content"},totalPath:{type:String,default:"payload.totalElements"},columns:{type:Array,default:function(){return[]}},searchForm:{type:Array,default:function(){return[]}},beforeSearch:{type:Function,default:function(){return Promise.resolve()}},routerMode:{type:String,default:"hash"},single:{type:Boolean,default:!1},hasOperation:{type:Boolean,default:!0},extraButtons:{type:Array,default:function(){return[]}},headerButtons:{type:Array,default:function(){return[]}},hasNew:{type:Boolean,default:!0},hasEdit:{type:Boolean,default:!0},hasView:{type:Boolean,default:!1},hasDelete:{type:Boolean,default:!0},canDelete:{type:Function,default:function(){return!0}},onNew:{type:Function},onEdit:{type:Function},onDelete:{type:Function},hasPagination:{type:Boolean,default:!0},paginationLayout:{type:String,default:"total, sizes, prev, pager, next, jumper"},paginationSizes:{type:Array,default:function(){return[10,20,30,40,50]}},paginationSize:{type:Number,default:10},noPaginationSize:{type:Number,default:999},isTree:{type:Boolean,default:!1},treeChildKey:{type:String,default:"children"},treeParentKey:{type:String,default:"parentId"},treeParentValue:{type:String,default:"id"},expandAll:{type:Boolean,default:!1},tableAttrs:{type:Object,default:function(){return{}}},operationAttrs:{type:Object,default:function(){return{width:"",fixed:"right"}}},hasDialog:{type:Boolean,default:!0},dialogNewTitle:{type:String,default:"新增"},dialogEditTitle:{type:String,default:"修改"},dialogViewTitle:{type:String,default:"查看"},form:{type:Array,default:function(){return[]}},formAttrs:{type:Object,default:function(){return{}}},extraParams:{type:Object},beforeConfirm:{type:Function,default:function(){return Promise.resolve()}},customQuery:{type:Object,default:function(){return{}}}},data:function(){return{data:[],hasSelect:this.columns.length&&"selection"==this.columns[0].type,size:this.paginationSize||this.paginationSizes[0],page:1,total:null,loading:!1,selected:[],customButtonsLoading:!1,dialogTitle:this.dialogNewTitle,dialogVisible:!1,isNew:!0,isEdit:!1,isView:!1,confirmLoading:!1,row:{},initCustomQuery:JSON.stringify(this.customQuery)}},watch:{url:function(e,t){this.page=1,this.getList()},dialogVisible:function(e,t){e||(this.isNew=!1,this.isEdit=!1,this.isView=!1,this.confirmLoading=!1,this.$refs.dialogForm.resetFields())}},mounted:function(){var e=this,t=this.$refs.searchForm;if(t){t.$el.setAttribute("action","javascript:;");var n=location.href.match(o);if(n){var s=n[0].substr(2).replace(a,"="),l=i.parse(s,{delimiter:","});this.page=1*l.page,this.size=1*l.size,t.updateForm(Object.keys(l).reduce(function(e,t){return"page"!==t&&"size"!==t&&(e[t]=l[t]),e},{}))}}this.$nextTick(function(){e.getList()})},methods:{getList:function(e){var i=this,n=this.$refs.searchForm,a=n?n.getFormValue():{},s=Object.assign({},a,this.customQuery),l=this.url,r="",c=this.hasPagination?this.size:this.noPaginationSize;if(!l)return void console.warn("DataTable: url 为空, 不发送请求");l.indexOf("?")>-1?l+="&":l+="?",r+="size="+c,r+=Object.keys(s).filter(function(e){return""!==s[e]&&null!==s[e]&&void 0!==s[e]}).reduce(function(e,t){return e+="&"+t+"="+encodeURIComponent(s[t].toString().trim())},"");var u=this.firstPage-1,d=this.page+u;if(this.loading=!0,this.$axios.get(l+r+"&page="+d).then(function(e){var n=e.data,a=[];i.hasPagination?(a=t(n,i.dataPath)||[],i.total=t(n,i.totalPath)):a=t(n,i.dataPath)||t(n,"payload")||[],i.data=a,i.isTree&&(i.data=i.tree2Array(a,i.expandAll)),i.loading=!1,i.$emit("update",a,n)}).catch(function(e){i.$emit("error",e),i.loading=!1}),this.routerMode&&e>0){var h="",f="q="+(r+"&page="+this.page).replace(/&/g,",").replace(/=/g,"~")+",";if(location.href.indexOf("q=")>-1)h=location.href.replace(o,f);else if("hash"==this.routerMode){var p=location.hash.indexOf("?")>-1?"&"+f:"?"+f;h=location.origin+location.pathname+location.search+location.hash+p}else{var g=location.search?"&"+f:"?"+f;h=location.origin+location.pathname+location.search+g+location.hash}history.pushState(history.state,"el-data-table search",h)}},search:function(){var e=this;this.$refs.searchForm.validate(function(t){t&&e.beforeSearch().then(function(){e.page=1,e.getList(!0)}).catch(function(t){e.$emit("error",t)})})},resetSearch:function(){var e=this;this.$refs.searchForm.resetFields(),this.page=1,history.replaceState(history.state,"",location.href.replace(o,"")),this.$nextTick(function(){e.getList()}),this.$emit("reset"),this.$emit("update:customQuery",Object.assign(this.customQuery,JSON.parse(this.initCustomQuery)))},handleSizeChange:function(e){this.size!==e&&(this.page=1,this.size=e,this.getList(!0))},handleCurrentChange:function(e){this.page!==e&&(this.page=e,this.getList(!0))},handleSelectionChange:function(e){this.selected=e,this.$emit("selection-change",e)},onDefaultNew:function(e){void 0===e&&(e={}),this.row=e,this.isNew=!0,this.isEdit=!1,this.isView=!1,this.dialogTitle=this.dialogNewTitle,this.dialogVisible=!0},onDefaultView:function(e){var t=this;this.row=e,this.isView=!0,this.isNew=!1,this.isEdit=!1,this.dialogTitle=this.dialogViewTitle,this.dialogVisible=!0,this.$nextTick(function(){t.$refs.dialogForm.updateForm(e)})},onDefaultEdit:function(e){var t=this;this.row=e,this.isEdit=!0,this.isNew=!1,this.isView=!1,this.dialogTitle=this.dialogEditTitle,this.dialogVisible=!0,this.$nextTick(function(){t.$refs.dialogForm.updateForm(e)})},cancel:function(){this.dialogVisible=!1},confirm:function(){var e=this;if(this.isView)return void this.cancel();this.$refs.dialogForm.validate(function(t){if(!t)return!1;var i=Object.assign({},e.$refs.dialogForm.getFormValue(),e.extraParams);e.isTree&&(e.isNew?i[e.treeParentKey]=e.row[e.treeParentValue]:i[e.treeParentKey]=e.row[e.treeParentKey]),e.beforeConfirm(i,e.isNew).then(function(t){var n="isNew",a="onNew";if(e.isEdit&&(n="isEdit",a="onEdit"),e[n]&&e[a])return void e[a](i,e.row).then(function(t){e.getList(),e.showMessage(!0),e.cancel()}).catch(function(e){});var o="post",s=e.url+"";e.isEdit&&(o="put",s+="/"+e.row[e.id]),e.confirmLoading=!0,e.$axios[o](s,i).then(function(t){e.getList(),e.showMessage(!0),e.cancel()}).catch(function(t){e.confirmLoading=!1})}).catch(function(e){})})},onDefaultDelete:function(e){var t=this;this.$confirm("确认删除吗","提示",{type:"warning",beforeClose:function(i,n,a){if("confirm"==i){if(n.confirmButtonLoading=!0,t.onDelete)return void t.onDelete(t.hasSelect?t.single?t.selected[0]:t.selected:e).then(function(e){t.showMessage(!0),a(),t.getList()}).catch(function(e){}).finally(function(e){n.confirmButtonLoading=!1});t.hasSelect?t.$axios.delete(t.url+"/"+t.selected.map(function(e){return e[t.id]}).toString()).then(function(e){n.confirmButtonLoading=!1,a(),t.showMessage(!0),t.getList()}).catch(function(e){n.confirmButtonLoading=!1}):t.$axios.delete(t.url+"/"+e[t.id]).then(function(e){n.confirmButtonLoading=!1,a(),t.showMessage(!0),t.getList()}).catch(function(e){n.confirmButtonLoading=!1})}else a()}}).catch(function(e){})},onCustomButtonsClick:function(e,t){var i=this;e&&(this.customButtonsLoading=!0,e(t).then(function(e){!1!==e&&i.getList()}).catch(function(e){}).finally(function(e){i.customButtonsLoading=!1}))},tree2Array:function(e,t,i,n){var a=this;void 0===i&&(i=null),void 0===n&&(n=null);var o=[];return e.forEach(function(e){void 0===e._expanded&&a.$set(e,"_expanded",t);var s=0;if(void 0!==n&&null!==n&&(s=n+1),a.$set(e,"_level",s),i&&a.$set(e,"parent",i),o.push(e),e[a.treeChildKey]&&e[a.treeChildKey].length>0){var l=a.tree2Array(e[a.treeChildKey],t,e,s);o=o.concat(l)}}),o},showRow:function(e){var t=!e.row.parent||e.row.parent._expanded&&e.row.parent._show;return e.row._show=t,t?"animation:treeTableShow 1s-webkit-animation:treeTableShow 1s":"display:none"},toggleExpanded:function(e){var t=this.data[e];t._expanded=!t._expanded},iconShow:function(e,t){return t[this.treeChildKey]&&t[this.treeChildKey].length>0},showMessage:function(e){void 0===e&&(e=!0),e?this.$message({type:"success",message:"操作成功"}):this.$message({type:"error",message:"操作失败"})}}},l={install:n},r=null;return"undefined"!=typeof window?r=window.Vue:"undefined"!=typeof global&&(r=global.Vue),r&&r.use(l),e.install=n,e.default=s,e}({},_get,qs);
