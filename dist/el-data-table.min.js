var ElDataTable=function(e,t){"use strict";function i(e){i.installed||(i.installed=!0,e.component("ElDataTable",n))}t=t&&t.hasOwnProperty("default")?t.default:t,function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),i=".el-data-table .ms-tree-space { position: relative; top: 1px; display: inline-block; font-style: normal; font-weight: 400; line-height: 1; width: 18px; height: 14px; } .el-data-table .ms-tree-space::before { content: ''; } .el-data-table .tree-ctrl { position: relative; cursor: pointer; color: #2196f3; } @-moz-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @-webkit-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @-o-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)),e.appendChild(t)}}();var n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"el-data-table"},[e.searchForm.length>0?i("el-form-renderer",{ref:"searchForm",attrs:{inline:"",content:e.searchForm}},[e._t("search"),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onSearch}},[e._v("查询")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:e.onResetSearch}},[e._v("重置")])],1)],2):e._e(),e._v(" "),e.hasNew||e.hasDelete||e.headerButtons.length>0?i("el-form",[i("el-form-item",[e.hasNew?i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onDefaultNew}},[e._v("新增")]):e._e(),e._v(" "),e._l(e.headerButtons,function(t,n){return"show"in t&&!t.show(e.selected)?e._e():i("el-button",e._b({key:n,attrs:{disabled:"disabled"in t&&t.disabled(e.selected),size:"small"},on:{click:function(i){t.atClick(e.selected)}}},"el-button",t,!1),[e._v(e._s(t.text))])}),e._v(" "),e.hasSelect&&e.hasDelete?i("el-button",{attrs:{type:"danger",size:"small",disabled:e.single?!e.selected.length||e.selected.length>1:!e.selected.length},on:{click:function(t){e.onDefaultDelete(t)}}},[e._v("删除")]):e._e()],2)],1):e._e(),e._v(" "),i("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{data:e.data,"row-style":e.showRow},on:{"selection-change":e.handleSelectionChange}},"el-table",e.table,!1),[e.isTree?[e.hasSelect?[i("el-table-column",e._b({key:"selection-key"},"el-table-column",e.columns[0],!1)),e._v(" "),i("el-table-column",e._b({key:"tree-ctrl",scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(t){return e.isTree?i("span",{key:t,staticClass:"ms-tree-space"}):e._e()}),e._v(" "),e.isTree&&e.iconShow(t.$index,t.row)?i("span",{staticClass:"tree-ctrl",on:{click:function(i){e.toggleExpanded(t.$index)}}},[t.row._expanded?i("i",{staticClass:"el-icon-minus"}):i("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(t.row[e.columns[1].prop])+" ")]}}])},"el-table-column",e.columns[1],!1)),e._v(" "),e._l(e.columns.filter(function(e,t){return 0!==t&&1!==t}),function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))})]:[i("el-table-column",e._b({key:"tree-ctrl",scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(t){return e.isTree?i("span",{key:t,staticClass:"ms-tree-space"}):e._e()}),e._v(" "),e.isTree&&e.iconShow(t.$index,t.row)?i("span",{staticClass:"tree-ctrl",on:{click:function(i){e.toggleExpanded(t.$index)}}},[t.row._expanded?i("i",{staticClass:"el-icon-minus"}):i("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(t.row[e.columns[0].prop])+" ")]}}])},"el-table-column",e.columns[0],!1)),e._v(" "),e._l(e.columns.filter(function(e,t){return 0!==t}),function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))})]]:e._l(e.columns,function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))}),e._v(" "),e.hasOperation?i("el-table-column",e._b({attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isTree&&e.hasNew?i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){e.onDefaultNew(t.row)}}},[e._v("新增")]):e._e(),e._v(" "),e._l(e.extraButtons,function(n,a){return"show"in n&&!n.show(t.row)?e._e():i("el-button",e._b({key:a,attrs:{size:"small"},on:{click:function(e){n.atClick(t.row)}}},"el-button",n,!1),[e._v(e._s(n.text))])}),e._v(" "),e.hasEdit?i("el-button",{attrs:{size:"small"},on:{click:function(i){e.onDefaultEdit(t.row)}}},[e._v(" 修改 ")]):e._e(),e._v(" "),!e.hasSelect&&e.hasDelete&&e.canDelete(t.row)?i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){e.onDefaultDelete(t.row)}}},[e._v(" 删除 ")]):e._e()]}}])},"el-table-column",e.operationAttrs,!1)):e._e(),e._v(" "),e._t("default")],2),e._v(" "),e.hasPagination?i("el-pagination",{staticStyle:{"text-align":"right",padding:"10px 0"},attrs:{"current-page":e.page,"page-sizes":e.paginationSizes,"page-size":e.size,total:e.total,layout:e.paginationLayout},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e(),e._v(" "),e.hasDialog?i("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form-renderer",e._b({ref:"dialogForm",attrs:{content:e.form}},"el-form-renderer",e.formAttrs,!1),[e._t("form")],2),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isView,expression:"!isView"}],attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("取 消")]),e._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.confirmLoading,expression:"confirmLoading"}],attrs:{type:"primary",size:"small"},on:{click:e.confirm}},[e._v("确 定")])],1)],1):e._e()],1)},staticRenderFns:[],name:"ElDataTable",props:{url:{type:String,default:""},firstPage:{type:Number,default:1},dataPath:{type:String,default:"payload.content"},totalPath:{type:String,default:"payload.totalElements"},columns:{type:Array,default:function(){return[]}},searchForm:{type:Array,default:function(){return[]}},single:{type:Boolean,default:!1},hasOperation:{type:Boolean,default:!0},extraButtons:{type:Array,default:function(){return[]}},headerButtons:{type:Array,default:function(){return[]}},hasNew:{type:Boolean,default:!0},hasEdit:{type:Boolean,default:!0},hasDelete:{type:Boolean,default:!0},canDelete:{type:Function,default:function(){return!0}},onDelete:{type:Function},hasPagination:{type:Boolean,default:!0},paginationLayout:{type:String,default:"total, sizes, prev, pager, next, jumper"},paginationSizes:{type:Array,default:function(){return[10,20,30,40,50]}},paginationSize:{type:Number,default:10},noPaginationSize:{type:Number,default:999},isTree:{type:Boolean,default:!1},treeChildKey:{type:String,default:"children"},treeParentKey:{type:String,default:"parentId"},treeParentValue:{type:String,default:"id"},expandAll:{type:Boolean,default:!1},tableAttrs:{type:Object,default:function(){return{}}},operationAttrs:{type:Object,default:function(){return{width:"",fixed:"right"}}},hasDialog:{type:Boolean,default:!0},dialogNewTitle:{type:String,default:"新增"},dialogEditTitle:{type:String,default:"修改"},dialogViewTitle:{type:String,default:"查看"},form:{type:Array,default:function(){return[]}},formAttrs:{type:Object,default:function(){return{}}},extraParams:{type:Object},customQuery:{type:Object,default:function(){return{}}}},data:function(){return{data:[],query:{},hasSelect:this.columns.length&&"selection"==this.columns[0].type,size:this.paginationSize||this.paginationSizes[0],page:this.firstPage,total:0,loading:!1,selected:[],dialogTitle:this.dialogNewTitle,dialogVisible:!1,isNew:!0,isEdit:!1,isView:!1,confirmLoading:!1,row:{},initCustomQuery:JSON.stringify(this.customQuery)}},mounted:function(){this.getList()},watch:{query:function(e,t){this.page=this.firstPage,this.getList()},url:function(e,t){this.page=this.firstPage,this.getList()},dialogVisible:function(e,t){var i=this;e||(this.isNew=!1,this.isEdit=!1,this.isView=!1,this.confirmLoading=!1,this.$refs.dialogForm.resetFields(),this.form.forEach(function(e){"select"===e.$type&&e.$el&&e.$el.multiple&&i.$refs.dialogForm.updateValue({id:e.$id,value:[]})}))}},methods:{getList:function(){var e=this,i=this.url,n=Object.assign({},this.query,this.customQuery),a=this.hasPagination?this.size:this.noPaginationSize;if(!i)return void console.warn("DataTable: url 为空, 不发送请求");i.indexOf("?")>-1?i+="&":i+="?",i+="page="+this.page+"&size="+a,i+=Object.keys(n).filter(function(e){return""!==n[e]&&null!==n[e]&&void 0!==n[e]}).reduce(function(e,t){return e+="&"+t+"="+n[t]},""),this.loading=!0,this.$axios.get(i).then(function(i){var n=i.data,a=[];e.hasPagination?(a=t(n,e.dataPath)||[],e.total=t(n,e.totalPath)):a=t(n,e.dataPath||"payload")||[],e.data=a,e.isTree&&(e.data=e.tree2Array(a,e.expandAll)),e.loading=!1,e.$emit("update",a,n)}).catch(function(t){e.loading=!1})},handleSizeChange:function(e){this.size!==e&&(this.size=e,this.getList())},handleCurrentChange:function(e){this.page!==e&&(this.page=e,this.getList())},handleSelectionChange:function(e){this.selected=e,this.$emit("selection-change",e)},onSearch:function(){var e=this.$refs.searchForm.getFormValue(),t=this.customQuery;this.query=Object.assign({},e,t)},onResetSearch:function(){this.$refs.searchForm.resetFields(),this.query={},this.$emit("reset"),this.$emit("update:customQuery",Object.assign(this.customQuery,JSON.parse(this.initCustomQuery)))},onDefaultNew:function(e){void 0===e&&(e={}),this.$emit("new",e),this.row=e,this.isNew=!0,this.isEdit=!1,this.isView=!1,this.dialogTitle=this.dialogNewTitle,this.dialogVisible=!0},onDefaultEdit:function(e){var t=this;this.$emit("edit",e),this.row=e,this.isEdit=!0,this.isNew=!1,this.isView=!1,this.dialogTitle=this.dialogEditTitle,this.dialogVisible=!0,this.$nextTick(function(){t.form.forEach(function(i){var n=e[i.$id];t.$refs.dialogForm.updateValue({id:i.$id,value:n})})})},cancel:function(){this.dialogVisible=!1},confirm:function(){var e=this;this.$refs.dialogForm.validate(function(t){if(!t)return!1;if(e.isView)return void e.cancel();var i=Object.assign({},e.$refs.dialogForm.getFormValue(),e.extraParams),n="post",a=e.url+"";e.isEdit&&(n="put",a+="/"+(e.row.id||e.row._id)),e.isTree&&(e.isNew?i[e.treeParentKey]=e.row[e.treeParentValue]:e.isEdit&&(i[e.treeParentKey]=e.row[e.treeParentKey])),e.confirmLoading=!0,e.$axios[n](a,i).then(function(t){e.getList(),e.showMessage(!0),e.cancel()}).catch(function(t){e.confirmLoading=!1})})},onDefaultDelete:function(e){var t=this;if(this.onDelete)return this.onDelete(e);this.$confirm("确认删除吗","提示",{type:"warning",beforeClose:function(i,n,a){"confirm"==i?(n.confirmButtonLoading=!0,t.hasSelect?t.$axios.delete(t.url+"/"+t.selected.map(function(e){return e._id||e.id}).toString()).then(function(e){n.confirmButtonLoading=!1,a(),t.showMessage(!0),t.getList()}).catch(function(e){n.confirmButtonLoading=!1}):t.$axios.delete(t.url+"/"+e.id||e._id).then(function(e){n.confirmButtonLoading=!1,a(),t.showMessage(!0),t.getList()}).catch(function(e){n.confirmButtonLoading=!1})):a()}}).catch(function(e){})},tree2Array:function(e,t,i,n){var a=this;void 0===i&&(i=null),void 0===n&&(n=null);var o=[];return e.forEach(function(e){void 0===e._expanded&&a.$set(e,"_expanded",t);var l=0;if(void 0!==n&&null!==n&&(l=n+1),a.$set(e,"_level",l),i&&a.$set(e,"parent",i),o.push(e),e[a.treeChildKey]&&e[a.treeChildKey].length>0){var s=a.tree2Array(e.children,t,e,l);o=o.concat(s)}}),o},showRow:function(e){var t=!e.row.parent||e.row.parent._expanded&&e.row.parent._show;return e.row._show=t,t?"animation:treeTableShow 1s-webkit-animation:treeTableShow 1s":"display:none"},toggleExpanded:function(e){var t=this.data[e];t._expanded=!t._expanded},iconShow:function(e,t){return t.children&&t.children.length>0},showMessage:function(e){void 0===e&&(e=!0),e?this.$message({type:"success",message:"操作成功"}):this.$message({type:"error",message:"操作失败"})}}},a={install:i},o=null;return"undefined"!=typeof window?o=window.Vue:"undefined"!=typeof global&&(o=global.Vue),o&&o.use(a),e.install=i,e.default=n,e}({},_get);
