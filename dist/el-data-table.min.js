var ElDataTable=function(e,t,i){"use strict";function a(e){a.installed||(a.installed=!0,e.component("ElDataTable",l))}t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i,function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),i=".el-data-table .ms-tree-space { position: relative; top: 1px; display: inline-block; font-style: normal; font-weight: 400; line-height: 1; width: 18px; height: 14px; } .el-data-table .ms-tree-space::before { content: ''; } .el-data-table .tree-ctrl { position: relative; cursor: pointer; color: #2196f3; } @-moz-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @-webkit-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @-o-keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } @keyframes treeTableShow { from { opacity: 0; } to { opacity: 1; } } ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)),e.appendChild(t)}}();var n=new RegExp("~","g"),o=new RegExp("q=.*,"),l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"el-data-table"},[e.searchForm.length>0||e.$slots.search?i("el-form-renderer",{ref:"searchForm",attrs:{inline:"",content:e.searchForm}},[e._t("search"),e._v(" "),i("el-form-item",[i("el-button",{attrs:{"native-type":"submit",type:"primary",size:"small"},on:{click:function(t){e.page=e.firstPage,e.getList(1)}}},[e._v("查询")]),e._v(" "),i("el-button",{attrs:{size:"small"},on:{click:e.resetSearch}},[e._v("重置")])],1)],2):e._e(),e._v(" "),e.hasNew||e.hasDelete||e.headerButtons.length>0?i("el-form",[i("el-form-item",[e.hasNew?i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onDefaultNew}},[e._v("新增")]):e._e(),e._v(" "),e._l(e.headerButtons,function(t,a){return"show"in t&&!t.show(e.selected)?e._e():i("el-button",e._b({key:a,attrs:{disabled:"disabled"in t&&t.disabled(e.selected),size:"small"},on:{click:function(i){t.atClick(e.selected)}}},"el-button",t,!1),[e._v(e._s(t.text))])}),e._v(" "),e.hasSelect&&e.hasDelete?i("el-button",{attrs:{type:"danger",size:"small",disabled:e.single?!e.selected.length||e.selected.length>1:!e.selected.length},on:{click:function(t){e.onDefaultDelete(t)}}},[e._v("删除")]):e._e()],2)],1):e._e(),e._v(" "),i("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{data:e.data,"row-style":e.showRow},on:{"selection-change":e.handleSelectionChange}},"el-table",e.tableAttrs,!1),[e.isTree?[e.hasSelect?[i("el-table-column",e._b({key:"selection-key"},"el-table-column",e.columns[0],!1)),e._v(" "),i("el-table-column",e._b({key:"tree-ctrl",scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(t){return e.isTree?i("span",{key:t,staticClass:"ms-tree-space"}):e._e()}),e._v(" "),e.isTree&&e.iconShow(t.$index,t.row)?i("span",{staticClass:"tree-ctrl",on:{click:function(i){e.toggleExpanded(t.$index)}}},[t.row._expanded?i("i",{staticClass:"el-icon-minus"}):i("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(t.row[e.columns[1].prop])+" ")]}}])},"el-table-column",e.columns[1],!1)),e._v(" "),e._l(e.columns.filter(function(e,t){return 0!==t&&1!==t}),function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))})]:[i("el-table-column",e._b({key:"tree-ctrl",scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row._level,function(t){return e.isTree?i("span",{key:t,staticClass:"ms-tree-space"}):e._e()}),e._v(" "),e.isTree&&e.iconShow(t.$index,t.row)?i("span",{staticClass:"tree-ctrl",on:{click:function(i){e.toggleExpanded(t.$index)}}},[t.row._expanded?i("i",{staticClass:"el-icon-minus"}):i("i",{staticClass:"el-icon-plus"})]):e._e(),e._v(" "+e._s(t.row[e.columns[0].prop])+" ")]}}])},"el-table-column",e.columns[0],!1)),e._v(" "),e._l(e.columns.filter(function(e,t){return 0!==t}),function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))})]]:e._l(e.columns,function(t){return i("el-table-column",e._b({key:t.prop},"el-table-column",t,!1))}),e._v(" "),e.hasOperation?i("el-table-column",e._b({attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isTree&&e.hasNew?i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){e.onDefaultNew(t.row)}}},[e._v("新增")]):e._e(),e._v(" "),e.hasEdit?i("el-button",{attrs:{size:"small"},on:{click:function(i){e.onDefaultEdit(t.row)}}},[e._v(" 修改 ")]):e._e(),e._v(" "),e.hasView?i("el-button",{attrs:{type:"info",size:"small"},on:{click:function(i){e.onDefaultView(t.row)}}},[e._v(" 查看 ")]):e._e(),e._v(" "),e._l(e.extraButtons,function(a,n){return"show"in a&&!a.show(t.row)?e._e():i("el-button",e._b({key:n,attrs:{size:"small"},on:{click:function(e){a.atClick(t.row)}}},"el-button",a,!1),[e._v(" "+e._s(a.text)+" ")])}),e._v(" "),!e.hasSelect&&e.hasDelete&&e.canDelete(t.row)?i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){e.onDefaultDelete(t.row)}}},[e._v(" 删除 ")]):e._e()]}}])},"el-table-column",e.operationAttrs,!1)):e._e(),e._v(" "),e._t("default")],2),e._v(" "),e.hasPagination?i("el-pagination",{staticStyle:{"text-align":"right",padding:"10px 0"},attrs:{"current-page":e.page,"page-sizes":e.paginationSizes,"page-size":e.size,total:e.total,layout:e.paginationLayout},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e(),e._v(" "),e.hasDialog?i("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form-renderer",e._b({ref:"dialogForm",attrs:{content:e.form,disabled:e.isView}},"el-form-renderer",e.formAttrs,!1),[e._t("form")],2),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isView,expression:"!isView"}],attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("取 消")]),e._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.confirmLoading,expression:"confirmLoading"}],attrs:{type:"primary",size:"small"},on:{click:e.confirm}},[e._v("确 定")])],1)],1):e._e()],1)},staticRenderFns:[],name:"ElDataTable",props:{url:{type:String,default:""},id:{type:String,default:"id"},firstPage:{type:Number,default:1},dataPath:{type:String,default:"payload.content"},totalPath:{type:String,default:"payload.totalElements"},columns:{type:Array,default:function(){return[]}},searchForm:{type:Array,default:function(){return[]}},routerMode:{type:String,default:"hash"},single:{type:Boolean,default:!1},hasOperation:{type:Boolean,default:!0},extraButtons:{type:Array,default:function(){return[]}},headerButtons:{type:Array,default:function(){return[]}},hasNew:{type:Boolean,default:!0},hasEdit:{type:Boolean,default:!0},hasView:{type:Boolean,default:!1},hasDelete:{type:Boolean,default:!0},canDelete:{type:Function,default:function(){return!0}},onNew:{type:Function},onEdit:{type:Function},onDelete:{type:Function},hasPagination:{type:Boolean,default:!0},paginationLayout:{type:String,default:"total, sizes, prev, pager, next, jumper"},paginationSizes:{type:Array,default:function(){return[10,20,30,40,50]}},paginationSize:{type:Number,default:10},noPaginationSize:{type:Number,default:999},isTree:{type:Boolean,default:!1},treeChildKey:{type:String,default:"children"},treeParentKey:{type:String,default:"parentId"},treeParentValue:{type:String,default:"id"},expandAll:{type:Boolean,default:!1},tableAttrs:{type:Object,default:function(){return{}}},operationAttrs:{type:Object,default:function(){return{width:"",fixed:"right"}}},hasDialog:{type:Boolean,default:!0},dialogNewTitle:{type:String,default:"新增"},dialogEditTitle:{type:String,default:"修改"},dialogViewTitle:{type:String,default:"查看"},form:{type:Array,default:function(){return[]}},formAttrs:{type:Object,default:function(){return{}}},extraParams:{type:Object},beforeConfirm:{type:Function,default:function(){return!0}},customQuery:{type:Object,default:function(){return{}}}},data:function(){return{data:[],hasSelect:this.columns.length&&"selection"==this.columns[0].type,size:this.paginationSize||this.paginationSizes[0],page:this.firstPage,total:0,loading:!1,selected:[],dialogTitle:this.dialogNewTitle,dialogVisible:!1,isNew:!0,isEdit:!1,isView:!1,confirmLoading:!1,row:{},initCustomQuery:JSON.stringify(this.customQuery)}},mounted:function(){var e=this,t=this.$refs.searchForm;if(t){t.$el.setAttribute("action","javascript:;");var a=location.href.match(o);if(a){var l=a[0].substr(2).replace(n,"="),s=i.parse(l,{delimiter:","});this.page=1*s.page,this.size=1*s.size,Object.keys(s).forEach(function(e){"page"!=e&&"size"!=e&&t.updateValue({id:e,value:s[e]})})}}this.$nextTick(function(){e.getList()})},watch:{url:function(e,t){this.page=this.firstPage,this.getList()},dialogVisible:function(e,t){var i=this;e||(this.isNew=!1,this.isEdit=!1,this.isView=!1,this.confirmLoading=!1,this.$refs.dialogForm.resetFields(),this.form.forEach(function(e){"select"===e.$type&&e.$el&&e.$el.multiple&&i.$refs.dialogForm.updateValue({id:e.$id,value:[]})}))}},methods:{getList:function(e){var i=this,a=this.$refs.searchForm,n=a?a.getFormValue():{},l=Object.assign({},n,this.customQuery),s=this.url,r="",c=this.hasPagination?this.size:this.noPaginationSize;if(!s)return void console.warn("DataTable: url 为空, 不发送请求");if(s.indexOf("?")>-1?s+="&":s+="?",r+="page="+this.page+"&size="+c,r+=Object.keys(l).filter(function(e){return""!==l[e]&&null!==l[e]&&void 0!==l[e]}).reduce(function(e,t){return e+="&"+t+"="+encodeURIComponent(l[t].toString().trim())},""),this.loading=!0,this.$axios.get(s+r).then(function(e){var a=e.data,n=[];i.hasPagination?(n=t(a,i.dataPath)||[],i.total=t(a,i.totalPath)):n=t(a,"payload.content")||t(a,"payload")||[],i.data=n,i.isTree&&(i.data=i.tree2Array(n,i.expandAll)),i.loading=!1,i.$emit("update",n,a)}).catch(function(e){i.$emit("error",e),i.loading=!1}),this.routerMode&&e>0){var u="",d="q="+r.replace(/&/g,",").replace(/=/g,"~")+",";if(location.href.indexOf("q=")>-1)u=location.href.replace(o,d);else if("hash"==this.routerMode){var h=location.hash.indexOf("?")>-1?"&"+d:"?"+d;u=location.origin+location.pathname+location.search+location.hash+h}else{var f=location.search?"&"+d:"?"+d;u=location.origin+location.pathname+location.search+f+location.hash}history.pushState(history.state,"el-data-table search",u)}},handleSizeChange:function(e){this.size!==e&&(this.page=this.firstPage,this.size=e,this.getList(!0))},handleCurrentChange:function(e){this.page!==e&&(this.page=e,this.getList(!0))},handleSelectionChange:function(e){this.selected=e,this.$emit("selection-change",e)},resetSearch:function(){var e=this;this.$refs.searchForm.resetFields(),this.page=this.firstPage,history.replaceState(history.state,"",location.href.replace(o,"")),this.$nextTick(function(){e.getList()}),this.$emit("reset"),this.$emit("update:customQuery",Object.assign(this.customQuery,JSON.parse(this.initCustomQuery)))},onDefaultNew:function(e){if(void 0===e&&(e={}),this.onNew)return this.onNew(e);this.$emit("new",e),this.row=e,this.isNew=!0,this.isEdit=!1,this.isView=!1,this.dialogTitle=this.dialogNewTitle,this.dialogVisible=!0},onDefaultView:function(e){var t=this;if(this.onView)return this.onView(e);this.$emit("view",e),this.row=e,this.isView=!0,this.isNew=!1,this.isEdit=!1,this.dialogTitle=this.dialogViewTitle,this.dialogVisible=!0,this.$nextTick(function(){t.form.forEach(function(i){var a=e[i.$id];t.$refs.dialogForm.updateValue({id:i.$id,value:a})})})},onDefaultEdit:function(e){var t=this;if(this.onEdit)return this.onEdit(e);this.$emit("edit",e),this.row=e,this.isEdit=!0,this.isNew=!1,this.isView=!1,this.dialogTitle=this.dialogEditTitle,this.dialogVisible=!0,this.$nextTick(function(){t.form.forEach(function(i){var a=e[i.$id];t.$refs.dialogForm.updateValue({id:i.$id,value:a})})})},cancel:function(){this.dialogVisible=!1},confirm:function(){var e=this;this.beforeConfirm()&&this.$refs.dialogForm.validate(function(t){if(!t)return!1;if(e.isView)return void e.cancel();var i=Object.assign({},e.$refs.dialogForm.getFormValue(),e.extraParams),a="post",n=e.url+"";e.isEdit&&(a="put",n+="/"+e.row[e.id]),e.isTree&&(e.isNew?i[e.treeParentKey]=e.row[e.treeParentValue]:e.isEdit&&(i[e.treeParentKey]=e.row[e.treeParentKey])),e.confirmLoading=!0,e.$axios[a](n,i).then(function(t){e.getList(),e.showMessage(!0),e.cancel()}).catch(function(t){e.confirmLoading=!1})})},onDefaultDelete:function(e){var t=this;if(this.onDelete)return this.onDelete(e);this.$confirm("确认删除吗","提示",{type:"warning",beforeClose:function(i,a,n){"confirm"==i?(a.confirmButtonLoading=!0,t.hasSelect?t.$axios.delete(t.url+"/"+t.selected.map(function(e){return e[t.id]}).toString()).then(function(e){a.confirmButtonLoading=!1,n(),t.showMessage(!0),t.getList()}).catch(function(e){a.confirmButtonLoading=!1}):t.$axios.delete(t.url+"/"+e[t.id]).then(function(e){a.confirmButtonLoading=!1,n(),t.showMessage(!0),t.getList()}).catch(function(e){a.confirmButtonLoading=!1})):n()}}).catch(function(e){})},tree2Array:function(e,t,i,a){var n=this;void 0===i&&(i=null),void 0===a&&(a=null);var o=[];return e.forEach(function(e){void 0===e._expanded&&n.$set(e,"_expanded",t);var l=0;if(void 0!==a&&null!==a&&(l=a+1),n.$set(e,"_level",l),i&&n.$set(e,"parent",i),o.push(e),e[n.treeChildKey]&&e[n.treeChildKey].length>0){var s=n.tree2Array(e[n.treeChildKey],t,e,l);o=o.concat(s)}}),o},showRow:function(e){var t=!e.row.parent||e.row.parent._expanded&&e.row.parent._show;return e.row._show=t,t?"animation:treeTableShow 1s-webkit-animation:treeTableShow 1s":"display:none"},toggleExpanded:function(e){var t=this.data[e];t._expanded=!t._expanded},iconShow:function(e,t){return t[this.treeChildKey]&&t[this.treeChildKey].length>0},showMessage:function(e){void 0===e&&(e=!0),e?this.$message({type:"success",message:"操作成功"}):this.$message({type:"error",message:"操作失败"})}}},s={install:a},r=null;return"undefined"!=typeof window?r=window.Vue:"undefined"!=typeof global&&(r=global.Vue),r&&r.use(s),e.install=a,e.default=l,e}({},_get,qs);
